FROM python:3.14-alpine

RUN addgroup -g 1000 appgroup && \
    adduser -u 1000 -G appgroup -D appuser

WORKDIR /app

RUN pip install --no-cache-dir \
    "fastmcp>=3.0.0" \
    httpx>=0.28.0 \
    pytest>=8.0.0 \
    pytest-asyncio>=0.23.0

COPY tests/e2e/mcp_live_test.py ./tests/e2e/
COPY tests/e2e/mcp_client_test.py ./tests/e2e/

RUN chown -R appuser:appgroup /app

USER appuser

ENV PYTHONPATH=/app

CMD ["pytest", "tests/e2e/mcp_live_test.py", "-v"]
